<% layout('../../../layouts/admin/app') %>

<% stylesheet('https://cdnjs.cloudflare.com/ajax/libs/iCheck/1.0.2/skins/flat/green.css') %>
<% stylesheet('https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.5/css/select2.min.css') %>
<% stylesheet('https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/6.6.4/sweetalert2.min.css') %>

<% script('https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.5/js/select2.full.min.js') %>
<% script('https://cdnjs.cloudflare.com/ajax/libs/iCheck/1.0.2/icheck.min.js') %>
<% script('https://cloud.tinymce.com/stable/tinymce.min.js?apiKey=z27ex772s1pdtappa5g4xgcmnefnoxrer6zhvwu743rri69i') %>
<% script('https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/6.6.4/sweetalert2.min.js') %>

<% block('title', 'Sản phẩm - Tạo sản phẩm mới') %>

<section class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1>Tạo sản phẩm</h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="/admin">Dashboard</a></li>
                    <li class="breadcrumb-item active">Tạo sản phẩm mới</li>
                </ol>
            </div>
        </div>
    </div>
</section>

<section class="content">
    <div class="container-fluid">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Tạo sản phẩm</h3>
            </div>
            <div class="card-body">
                <form class="blog-articles__form" action="" enctype="multipart/form-data" method="POST">
                    <div class="form-group">
                        <label for="name">Tên sản phẩm</label>
                        <input type="text" class="form-control form__title__input" value="<%= old('name') %>" id="name" name="name">
                        <p class="form__error-message form__title__error-message"><%= errors('name') %></p>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Thể loại</label>
                                <select class="form-control form__category__input" name="type" style="width: 100%;">
                                    <option value="0">Chọn thể loại</option>
                                    <% productTypes.forEach(function (element) { %>
                                    <option <%= old('type') == element._id ? 'selected' : '' %>
                                            value="<%= element._id %>"><%= element.name %></option>
                                    <% }) %>
                                </select>
                                <p class="form__error-message form__category__error-message"><%= errors('type') %></p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Ảnh</label>
                                <div class="custom-file">
                                    <input type="file" class="custom-file-input" name="image" id="validatedCustomFile">
                                    <label class="custom-file-label" for="validatedCustomFile">Chọn ảnh</label>
                                </div>
                                <p class="form__error-message form__image__error-message"><%= errors('image') %></p>
                            </div>
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-12 col-md">
                            <label for="sku">Mã sản phẩm (SKU)</label>
                            <input type="text" class="form-control form__title__input" value="<%= old('sku') %>" id="sku" name="sku">
                            <p class="form__error-message form__title__error-message"><%= errors('sku') %></p>
                        </div>
                        <div class="col-12 col-md">
                            <label for="quantity">Số lượng hàng</label>
                            <input type="number" min="0" class="form-control form__title__input" value="<%= old('quantity') %>" id="quantity" name="quantity">
                            <p class="form__error-message form__title__error-message"><%= errors('quantity') %></p>
                        </div>
                    </div>

                    <div class="form-group row">
                            <div class="col-12 col-md">
                                <div class="row justify-content-between m-0">
                                    <div class="col p-0">
                                        <label for="price">Giá tiền: (ngàn đồng)</label>
                                    </div>
                                    <div class="col-auto text-right font-weight-light font-weight-bold">
                                        <span id="priceText">
                                            <%= old('priceValue') %> ₫
                                        </span>
                                        <input type="hidden" name="priceText" value="<%= old('priceText') %>">
                                        <input type="hidden" name="priceValue" value="<%= old('priceValue') %>">
                                    </div>
                                </div>
                                <div class="input-group">
                                    <input type="text" autocomplete="off" maxlength="15" data-original="" class="form-control" id="price" name="priceInput" placeholder="Nhập giá (ngàn đồng)" value="">
                                </div>
                                <p class="form__error-message form__title__error-message"><%= errors('priceValue') %></p>
                            </div>
                            <div class="col-12 col-md">
                                <div class="row justify-content-between m-0">
                                    <div class="col p-0">
                                        <label for="discount">Giảm giá (đơn vị %)</label>
                                    </div>
                                    <div class="col-auto text-right font-weight-light font-weight-bold">
                                        <span id="discountedPrice">

                                        </span>
                                        <input type="hidden" min="0" max="1" value="<%= old('discount') %>" id="discount" name="discount">
                                    </div>
                                </div>
                                <div class="input-group">
                                    <input type="number" min="0" max="100" class="form-control form__title__input" id="discountInput" name="discountInput">
                                </div>
                                <p class="form__error-message form__title__error-message"><%= errors('discount') %></p>
                            </div>
                    </div>

                    <div class="form-group">
                        <label for="info">Giới thiệu sản phẩm</label>
                        <textarea name="info" id="info" class="form-control tinymce"><%= old('info') %></textarea>
                        <p class="form__error-message form__title__error-message"><%= errors('info') %></p>
                    </div>
                    <div class="form-group">
                        <label>Chi tiết sản phẩm</label>
                        <textarea name="detail" class="form-control form__content__input tinymce"><%= old('detail') %></textarea>
                        <p class="form__error-message form__content__error-message"><%= errors('detail') %></p>
                    </div>
                    <div class="form-group">
                        <label for="isDraft">
                            <input type="checkbox" name="isDraft" id="isDraft" class="flat-red" <%= old('isDraft') ? 'checked' : '' %>> Nháp
                        </label>
                    </div>
                    <button type="submit" class="btn btn-primary">Đăng bài</button>
                </form>
            </div>
        </div>
    </div>
</section>

<% block('scripts', `
<script>
    $(document).ready(function () {
        $('.select2').select2();
        $('input[type="checkbox"], input[type="radio"]').iCheck({
            checkboxClass: 'icheckbox_flat-green',
            radioClass: 'iradio_flat-green'
        });
        convertPercent ();
        getCurrency();
        discountedPrice();
        tinymce.init({
            selector: 'textarea.tinymce',
            height: 500,
            plugins: 'print preview fullpage searchreplace autolink directionality visualblocks visualchars fullscreen image link media template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists textcolor wordcount imagetools contextmenu colorpicker textpattern help',
            toolbar: "insertfile undo redo | styleselect | fontsizeselect | bold italic strikethrough forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image",
            images_upload_handler: function (blobInfo, success, failure) {
                const formData = new FormData();
                formData.append('images', blobInfo.blob(), blobInfo.filename());
                $.ajax({
                    url: '/admin/images/upload',
                    type: 'POST',
                    dataType: 'json',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (res) {
                        if (!res.status) {
                            failure(res.error.message[0]);
                        }
                        success(res.data[0]);
                    }
                });
            }
        });
    });
</script>
`) %>
